---
import { Slogan } from "./_components/slogan";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Image } from "astro:assets";
import PublicLayout from "@/layouts/public-layout.astro";
import { Separator } from "@/components/ui/separator";
import { actions } from "astro:actions";
import { Config } from "@/config";
import { annouyncementsUsecase } from "@/core/announcement/usecase";
import { newsUsecase } from "@/core/news/usecase";
import { personUsecase } from "@/core/person/usecase";
import { AnnouncementCard } from "@/components/announcement/announcement-card";
import { NewsCard } from "@/components/news/news-card";
import { CommanderSection } from "./_components/CommanderSection";
import { configUsecase } from "@/core/config/usecase";
import HeroSection from "./_components/hero-section.astro";
import GreetingPopup from "@/components/layouts/public/greeting-popup";

const config = await configUsecase.getGlobalSettings({});

const { items: latestNews } = await newsUsecase.getMany({
  published: true,
  pageSize: 6,
  orderBy: "publishedAt",
  direction: "desc",
});

const { items: announcements } = await annouyncementsUsecase.getMany({
  published: true,
  pageSize: 6,
  orderBy: "publishedAt",
  direction: "desc",
  tags: config?.announcementsTag ? [config.announcementsTag] : undefined,
});

const commander = await personUsecase.getByOrder(1);
if (commander?.portrait) {
  commander.portrait = Config.getFileURL(commander.portrait);
}
console.log(config);
---

<PublicLayout>
  <Fragment slot="head">
    <title>วงรอบทหารที่ 16 - หน้าแรก</title>
    <meta
      name="description"
      content="เว็บไซต์ทางการของวงรอบทหารที่ 16 รับข่าวสารล่าสุดเกี่ยวกับข่าว ประกาศ และทรัพยากร"
    />
  </Fragment>
  <Fragment slot="body">
    <main class="min-h-screen bg-background">
      <!-- Hero Section -->
      <HeroSection
        heroImage={config?.heroImage
          ? Config.getFileURL(config.heroImage.id)
          : ""}
      />

      <!-- Unit Slogan Section -->
      <section class="py-16 px-4 bg-muted">
        <div class="container mx-auto text-center">
          <div class="mb-12">
            <h2 class="text-4xl font-bold mb-4">คำขวัญหน่วย</h2>
            <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
              คำขวัญที่เป็นแรงบันดาลใจนำทางหน่วยของเราไปสู่ความสำเร็จ
            </p>
          </div>
          <div class="mb-12">
            <Slogan client:visible />
          </div>
        </div>
      </section>

      <!-- Commanding Officer -->
      {commander && <CommanderSection person={commander} />}

      <!-- Announcements -->
      <section
        class="py-16 px-4 bg-gradient-to-br from-muted/10 via-background to-muted/20"
      >
        <div class="container mx-auto">
          <div class="text-center mb-12">
            <h2 class="text-4xl font-bold mb-4 text-accent">ประกาศสำคัญ</h2>
            <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
              อัปเดตและประกาศสำคัญที่ส่งผลต่อหน่วยและชุมชนของเรา
            </p>
          </div>
          <div
            class="grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 max-w-6xl mx-auto"
          >
            {
              announcements.map((announcement) => (
                <AnnouncementCard announcement={announcement} />
              ))
            }
          </div>
          <div class="text-center mt-8">
            <Button size="lg" className="px-8">
              <a href="/announcements">ดูประกาศเพิ่มเติม</a>
            </Button>
          </div>
        </div>
      </section>

      <!-- Latest News -->
      <section class="py-16 px-4 bg-muted/30">
        <div class="container mx-auto">
          <div class="text-center mb-12">
            <h2 class="text-4xl font-bold mb-4 text-accent">ข่าวล่าสุด</h2>
            <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
              รับข่าวสารล่าสุดเกี่ยวกับการพัฒนาและเรื่องราวจากหน่วยของเรา
            </p>
          </div>
          <div
            class="grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 max-w-6xl mx-auto"
          >
            {latestNews.map((news) => <NewsCard news={news} />)}
          </div>
          <div class="text-center mt-8">
            <Button size="lg" className="px-8">
              <a href="/news">ดูข่าวเพิ่มเติม</a>
            </Button>
          </div>
        </div>
      </section>
    </main>
  </Fragment>
</PublicLayout>
